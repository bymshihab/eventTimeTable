<div class="scheduler-container" [class.scrolling]="isScrolling()">

  <!-- Tab Bar - Fixed at top -->
  <div class="tab-bar-section">
    <app-tab-bar (daySelected)="onDaySelected($event)"></app-tab-bar>
  </div>

  <!-- Scroll Indicators -->
  @if (showScrollIndicators()) {
    <div class="scroll-indicators">
      <div class="scroll-indicator vertical-indicator"></div>
      <div class="scroll-indicator horizontal-indicator"></div>
    </div>
  }

  <!-- Main Scheduler Grid -->
  @if (selectedDay(); as day) {
    <div class="scheduler-grid">

      <!-- Time Label Column - Fixed Left using CSS Grid -->
      <div class="time-column">
        <!-- Time Header -->
        <div class="time-header">
          <span class="time-header-text">Time</span>
        </div>

        <!-- Scrollable Time Labels -->
        <div #timeContainer class="time-content">
          <app-time-label
            [startTime]="startTime"
            [endTime]="endTime"
            [intervalMinutes]="intervalMinutes"
            [sticky]="false">
          </app-time-label>
        </div>
      </div>

      <!-- Venues and Events Section - CSS Grid Area -->
      <div class="venues-section">

        <!-- Venue Headers - Horizontal Scrollable -->
        <div #venuesContainer class="venue-headers-container">
          <div class="venue-headers-scroll">
            @for (venue of day.venues; track venue.id) {
              <div class="venue-header-wrapper">
                <app-venue-card [venueName]="venue.name"></app-venue-card>
              </div>
            }
          </div>
        </div>

        <!-- Events Grid - Both Horizontally and Vertically Scrollable -->
        <div #eventGrid class="events-grid-container">
          <div class="events-grid-content" [style.height.px]="totalHeight()">

            <!-- Grid Background Lines -->
            <div class="grid-lines">
              <!-- Vertical lines for venues -->
              @for (venue of day.venues; track venue.id; let i = $index) {
                <div
                  class="grid-line-vertical"
                  [style.left.px]="i * 200 + 200">
                </div>
              }

              <!-- Horizontal lines for time intervals -->
              @for (i of getGridLineCount(); track i) {
                <div
                  class="grid-line-horizontal"
                  [class]="isHourLine(i) ? 'hour-line' : 'interval-line'"
                  [style.top.px]="i * rowHeight"
                  [style.width.px]="day.venues.length * 200">
                </div>
              }
            </div>

            <!-- Event Columns for each venue -->
            <div class="venues-container">
              @for (venue of day.venues; track venue.id; let venueIndex = $index) {
                <div class="venue-events-column"
                     [style.width.px]="200"
                     [style.min-width.px]="200">

                  <!-- Events for this venue using EventCardComponent -->
                  @for (event of getEventsForVenue(venue.id); track event.id) {
                    <div
                      class="event-wrapper"
                      [style.top.px]="event.topPosition">
                      <app-event-card
                        [title]="event.title"
                        [startTime]="event.startTime"
                        [durationMinutes]="event.durationMinutes"
                        [intervalMinutes]="intervalMinutes"
                        [rowHeight]="rowHeight">
                      </app-event-card>
                    </div>
                  }
                </div>
              }
            </div>
          </div>
        </div>
      </div>
    </div>
  } @else {
    <!-- Loading/No Day Selected State -->
    <div class="loading-state">
      <div class="loading-content">
        @if (isLoading()) {
          <div class="loading-spinner-container">
            <div class="loading-spinner"></div>
            <p class="loading-text-primary">Loading scheduler...</p>
            <p class="loading-text-secondary">Fetching events and venues</p>
          </div>
        } @else {
          <div class="empty-state">
            <svg class="empty-state-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
            </svg>
            <p class="empty-state-title">Select a day to view schedule</p>
            <p class="empty-state-subtitle">Choose a day from the tabs above to see events</p>
          </div>
        }
      </div>
    </div>
  }
</div>
